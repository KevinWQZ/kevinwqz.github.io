<!DOCTYPE html>
<html>

  
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="baidu-site-verification" content="vuqzu4486i" />
  <meta name="baidu-site-verification" content="yR54QJzaFG" />
  <title>Python èŒæ–° - å®ç° Markdown å›¾ç‰‡ä¸‹è½½å™¨</title>
  <meta name="description" content="">
  <meta name="author" content="xie tao">

<!--   <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Python èŒæ–° - å®ç° Markdown å›¾ç‰‡ä¸‹è½½å™¨">
  <meta name="twitter:description" content=""> -->
  
<!--   <meta property="og:type" content="article">
  <meta property="og:title" content="Python èŒæ–° - å®ç° Markdown å›¾ç‰‡ä¸‹è½½å™¨">
  <meta property="og:description" content=""> -->
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.ico" />
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2018/01/XTImageDownloader/">
  <link rel="alternate" type="application/rss+xml" title="wangquanzhen" href="http://localhost:4000/feed.xml">
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?df0994aacf7a4c9779a5632908de3196";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="å‰å¾€ wangquanzhen çš„ä¸»é¡µ" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="wangquanzhen logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="å‰å¾€ wangquanzhen çš„ä¸»é¡µ" class="blog-button">wangquanzhen</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">æ¢ç´¢ä¹‹æ—…ï¼Œå­¦ä¹ ä¹‹è·¯</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æƒæŒ¯ï¼æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººä¸»é¡µ.</br>90åä»£ç æ¬è¿å·¥ï¼Œ</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="è¿›å…¥åšå®¢" class="blog-button">åšå®¢</a></li>
                
                  <li class="navigation__item"><a href="/about/index.html" target="_blank" title="äº†è§£æ›´å¤šå…³äºæˆ‘">å…³äº</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
  
    <a href="http://weibo.com/u/2803559240" title="xietao3 çš„å¾®åš" target="_blank">
    <!-- <a href="http://weibo.com/xietao3" title="xietao3 çš„å¾®åš" target="_blank"> -->
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/xietao3" title="xietao3 çš„ Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  

  

  
   <!-- CSDN -->
  <li class="navigation__item">
    <a href="http://blog.csdn.net/xietao3" title="xietao3 çš„ CSDN" target="_blank">
      <img src="/assets/images/csdn.png" width="20" height="20" />
      <!-- <i class='social fa fa-edit'></i> -->
      <span class="label">csdn</span>
    </a>
  </li>
  

  <!-- RSS -->
<!--   <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li> -->

  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-orange"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-01-19 23:40:11 +0800" itemprop="datePublished" class="post-meta__date date">2018-01-19</time> &#8226; <span class="post-meta__tags tags"></span>
    </div>
    <h1 class="post-title">Python èŒæ–° - å®ç° Markdown å›¾ç‰‡ä¸‹è½½å™¨</h1>
  </header>

  <section class="post">
    <p><img src="http://upload-images.jianshu.io/upload_images/1319710-1aabe51b7e2103aa.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æ¥è‡ªç½‘ç»œ" /></p>

<blockquote>
  <p>ç®€ä¹¦æ”¯æŒæ‰“åŒ…ä¸‹è½½æ‰€æœ‰æ–‡ç« åŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿ä½œè€…è½¬ç§»æˆ–ä¿å­˜ã€‚ä½†æ˜¯å›¾ç‰‡ä¸æ”¯æŒè‡ªåŠ¨ä¸‹è½½ï¼Œæœ€è¿‘åœ¨å­¦Pythonï¼Œä¾¿å†™äº†ä¸€ä¸ªmdå›¾ç‰‡ä¸‹è½½å™¨ã€‚</p>
</blockquote>

<h1 id="ç›®æ ‡">ç›®æ ‡</h1>

<p>æœ¬äºº Python æ–°æ‰‹ï¼Œæ¬¢è¿å¤§ä½¬æŒ‡ç‚¹ã€‚æœ¬æ–‡ä¸»è¦æ˜¯å¯¹æºç è¿›è¡Œè§£è¯»ï¼ŒæœŸæœ›å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š</p>

<ol>
  <li>ä¸€é”®ä¸‹è½½æ‰€æœ‰Markdownæ–‡ä»¶ä¸­çš„å›¾ç‰‡ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚</li>
  <li>å›¾ç‰‡æ ¹æ®æ–‡ç« åˆ†ç±»</li>
  <li>ç®€å•æ˜“ç”¨ã€‚</li>
</ol>

<p><strong>å…ˆä¸Šæœ€ç»ˆæ•ˆæœ:</strong></p>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-127db2a56d226360.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½è¿‡ç¨‹" /></p>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-5cabb727b08a014b.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½å®Œæˆ" /></p>

<h1 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h1>

<ol>
  <li>æœç´¢æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œæ‰¾å‡ºæ–‡ä»¶å¤¹åŠå­æ–‡ä»¶åŒ…å«çš„mdæ–‡ä»¶ã€‚</li>
  <li>åŒ¹é…å‡ºmdæ–‡ä»¶ä¸­æ‰€æœ‰çš„å›¾ç‰‡ã€‚</li>
  <li>æ‰€æœ‰å›¾ç‰‡å¼‚æ­¥ä¸‹è½½ã€‚</li>
  <li>ä¸‹è½½æŠ¥å‘Šä¸GUIã€‚</li>
  <li>Python æ‰“åŒ…å·¥å…·ã€‚</li>
</ol>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-836030e0e5407304.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å‡†å¤‡å¼€å·¥" /></p>

<h2 id="1-æœç´¢æ–‡ä»¶å¤¹ä¸­mdæ–‡ä»¶">1. æœç´¢æ–‡ä»¶å¤¹ä¸­mdæ–‡ä»¶</h2>

<p>é¦–å…ˆæˆ‘ä»¬è¦æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„æ–‡ä»¶å¤¹ï¼Œæœç´¢å‡ºè¯¥æ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹ä¸­åŒ…å«çš„mdæ–‡ä»¶ï¼Œå¹¶å°†è¿™äº›æ–‡ä»¶çš„ç»å¯¹è·¯å¾„åŠ åˆ°æ•°ç»„å½“ä¸­ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Directory(object):

    @classmethod
    def find_sub_path(cls, path):
        # åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ–‡ç« åˆ—è¡¨
        article_list = []
        # è·å–è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ‰€ä»¥å­æ–‡ä»¶
        temp_files = os.listdir(path)
        # éå†å­æ–‡ä»¶
        for temp_file in temp_files:
            # æ‹¼æ¥è¯¥æ–‡ä»¶ç»å¯¹è·¯å¾„
            full_path = os.path.join(path, temp_file)

            # åŒ¹é….mdæ–‡ä»¶
            if os.path.isfile(full_path) and os.path.splitext(full_path)[1] == ".md":
                # å¦‚æœæ˜¯.mdæ–‡ä»¶ åŠ å…¥æ–‡ç« åˆ—è¡¨
                article = Article(full_path)
                article_list.append(article)
            # å¦‚æœæ˜¯æ–‡ä»¶å¤¹ è¿›è¡Œé€’å½’ç»§ç»­æœç´¢
            elif os.path.isdir(full_path):
                # å°†å­æ–‡ä»¶å¤¹ä¸­çš„æ–‡ç« åˆ—è¡¨æ‹¼æ¥åˆ°ä¸Šçº§ç›®å½•çš„æ–‡ç« åˆ—è¡¨ä¸­
                article_list.extend(cls.find_sub_path(full_path))

        return article_list
</code></pre></div></div>

<h2 id="2-åŒ¹é…å‡ºmdæ–‡ä»¶ä¸­çš„å›¾ç‰‡">2. åŒ¹é…å‡ºmdæ–‡ä»¶ä¸­çš„å›¾ç‰‡</h2>

<p>ä¸ºæ¯ä¸€ç¯‡æ–‡ç« æ–°å»ºä¸€ä¸ªå­˜æ”¾è¯¥æ–‡ç« ä¸­å›¾ç‰‡çš„æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ©ç”¨æ­£åˆ™åŒ¹é…å‡ºè¯¥æ–‡ç« ä¸­çš„æ‰€ä»¥å›¾ç‰‡ï¼Œå¹¶ä¿å­˜åˆ°å›¾ç‰‡æ•°ç»„ä¸­ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># æ–‡ç« ç±»

class Article(object):

    def __init__(self, path):
        # æ–‡ç« çš„ç»å¯¹è·¯å¾„
        self.article_path = path
        # æ‹¼æ¥æ–‡ç« å›¾ç‰‡ä¸‹è½½åä¿å­˜çš„è·¯å¾„
        self.article_pic_dir = path.replace(".md", "_Image")
        # æ–°å»ºä¿å­˜æ–‡ç« å›¾ç‰‡çš„æ–‡ä»¶å¤¹
        self.mkdir_image_dir()
        # å¼€å§‹æœç´¢å›¾ç‰‡
        self.pic_list = self.find_pics(self.article_path)

    # æŸ¥æ‰¾å›¾ç‰‡
    def find_pics(self, article_path):
        # æ‰“å¼€mdæ–‡ä»¶
        f = open(article_path, 'r')
        content = f.read()
        pics = []

        # åŒ¹é…æ­£åˆ™ match ![]()
        results = re.findall(r"!\[(.+?)\)", content)

        index = 0
        for result in results:
            temp_pic = result.split("](")
            # å°†å›¾ç‰‡åŠ å…¥åˆ°å›¾ç‰‡æ•°ç»„å½“ä¸­
            if len(temp_pic) == 2:
                pic = Picture(temp_pic[0], temp_pic[1], self.article_pic_dir, index)
                pics.append(pic)
            index += 1
        f.close()
        return pics

    # æ–°å»ºå›¾ç‰‡çš„ä¿å­˜æ–‡ä»¶å¤¹
    def mkdir_image_dir(self):
        # å¦‚æœè¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ åˆ™æ–°å»ºä¸€ä¸ª
        if not os.path.exists(self.article_pic_dir):
            os.mkdir(self.article_pic_dir)
</code></pre></div></div>

<h2 id="3-ä¸‹è½½å›¾ç‰‡">3. ä¸‹è½½å›¾ç‰‡</h2>

<p>ç®€å•åœ°åˆ¤æ–­äº†å›¾ç‰‡æ˜¯å¦æœ‰ç±»å‹ï¼Œæ‹¼æ¥å›¾ç‰‡çš„ä¿å­˜è·¯å¾„ä¸å‘½åã€‚æ£€æŸ¥å›¾ç‰‡æ˜¯å¦é‡å¤ä¸‹è½½ï¼Œæ£€æŸ¥å›¾ç‰‡é“¾æ¥æ˜¯å¦åˆæ³•ï¼Œä¸‹è½½å¹¶ä¸”ä¿å­˜å›¾ç‰‡ï¼ŒåŒæ—¶åšäº†ä¸‹è½½å¤±è´¥çš„å¤„ç†å’Œä¿å­˜å¤±è´¥çš„å¤„ç†ï¼Œä¿å­˜äº†ä¸‹è½½å¤±è´¥çš„åŸå› ï¼Œä»¥ä¾¿åé¢ç”ŸæˆæŠ¥å‘Šã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># å›¾ç‰‡ç±»
class Picture(object):

    def __init__(self, name, url, dir_path, index):
        # è¯¥å›¾ç‰‡é¡ºåºä¸‹æ ‡  ç”¨äºè®¾ç½®é»˜è®¤å›¾ç‰‡åå­—
        self.index = index
        # å›¾ç‰‡å
        self.name = name
        # å›¾ç‰‡é“¾æ¥
        self.url = url
        # å›¾ç‰‡ä¿å­˜è·¯å¾„
        self.dir_path = dir_path
        # å›¾ç‰‡ä¸‹è½½å¤±è´¥åŸå› 
        self.error_reason = None

    # å¼€å§‹ä¸‹è½½
    def start_download_pic(self, download_pic_callback):
        pic_path = self.build_pic_name()

        # å·²å­˜åœ¨åˆ™ä¸é‡å¤ä¸‹è½½
        if os.path.exists(pic_path):
            print ('pic has existed:' + self.url)
            self.error_reason = "pic has existed:"
            download_pic_callback(self)
            return

        # å›¾ç‰‡é“¾æ¥å‰ç¼€ä¸åŒ…å«http
        if not self.url.startswith("http"):
            print ('pic has invalid url:' + self.url)
            self.error_reason = "pic has invalid url"
            download_pic_callback(self)
            return

        header = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36',
            'Cookie': 'AspxAutoDetectCookieSupport=1',
        }

        # ä¸‹è½½å›¾ç‰‡
        request = urllib2.Request(self.url, None, header)
        try:
            response = urllib2.urlopen(request, timeout=10)
        # ä¸‹è½½å¤±è´¥
        except Exception, error:
            print ('pic cannot download:' + self.url)
            self.error_reason = str(error)
            download_pic_callback(self)
            return

        # ä¿å­˜å›¾ç‰‡
        try:
            fp = open(pic_path, 'wb')
            fp.write(response.read())
            fp.close()
        # ä¿å­˜å¤±è´¥
        except IOError, error:
            print(error)
            self.error_reason = str(error)
            download_pic_callback(self)
            return

        # ä¸‹è½½å®Œæˆå›è°ƒ
        download_pic_callback(self)

    # ç»„è£…å›¾ç‰‡ä¿å­˜å‘½å
    def build_pic_name(self):
        # å‰ªå»å›¾ç‰‡é“¾æ¥åçš„å‚æ•°
        pic_url = self.url.split("?")[0]

        # è·å–å›¾ç‰‡æ ¼å¼åç¼€ å¦‚æœæ²¡æœ‰ é»˜è®¤jpg
        urls = pic_url.split(".")
        if len(urls) &gt; 1:
            pic_type = urls[len(urls)-1]
        else:
            pic_type = "jpg"

        # ç»„è£…å›¾ç‰‡å‘½å
        if self.name is not None and len(self.name) &gt; 0:
            pic_name = self.name + "." + pic_type
        else:
            pic_name = "no_name_" + str(self.index) + "." + pic_type

        pic_path = os.path.join(self.dir_path, pic_name)
        return pic_path
</code></pre></div></div>

<h2 id="4-ä¸‹è½½æŠ¥å‘Šä¸gui">4. ä¸‹è½½æŠ¥å‘Šä¸GUI</h2>

<p>a. æœ¬æ¥ <code class="highlighter-rouge">XTImageDownloader</code> å’Œ <code class="highlighter-rouge">GUI</code> åº”è¯¥åˆ†å¼€ï¼Œä½†æ˜¯å¯¹ <code class="highlighter-rouge">Tkinter</code> ç†è§£è¿˜æœ‰é™ï¼Œæ‰€ä»¥å°±ç›´æ¥å†™ï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚</p>

<p>è¿™éƒ¨åˆ†ä»£ç ä¸»è¦æ˜¯ <strong>é€‰æ‹©æ–‡ä»¶å¤¹</strong> å’Œ <strong>å¼€å§‹æœç´¢å¹¶ä¸‹è½½</strong> çš„ UI åŠé€»è¾‘å¤„ç†ã€‚</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-8dc42ba95b02bbbb.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©æ–‡ä»¶å¤¹" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class XTImageDownloader(object):

    def __init__(self):
        # æ•°æ®
        self.download_error_list = []
        self.all_pic_count = 0
        self.current_pic_index = 0
        self.thread_lock = threading.Lock()
        self.search_button = None
        # å›¾å½¢ç•Œé¢ç›¸å…³
        self.root = Tk()
        self.root.title("XTImageDownloader")
        self.path = StringVar()
        self.title = StringVar()
        self.title.set("è¯·é€‰æ‹©Markdownæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹")
        self.list_box = None
        Label(self.root, textvariable=self.title).grid(row=0, column=1)
        Label(self.root, text="æ–‡ä»¶å¤¹è·¯å¾„:").grid(row=1, column=0)
        Entry(self.root, textvariable=self.path).grid(row=1, column=1)
        Button(self.root, text="é€‰æ‹©è·¯å¾„", command=self.select_path).grid(row=1, column=2)
        self.root.mainloop()

    # é€‰æ‹©æ–‡ä»¶å¤¹
    def select_path(self):
        self.path.set(tkFileDialog.askdirectory())
        # ç”¨æˆ·é€‰ä¸­æ–‡ä»¶å¤¹ä¹‹å æ˜¾ç¤ºä¸‹è½½æŒ‰é’®
        if self.path.get() != "":
            self.search_button = Button(self.root, text="å¼€å§‹æœç´¢å¹¶ä¸‹è½½", command=self.start_search_dir)
            self.search_button.grid(row=2, column=1)
            return self.path

    # å¼€å§‹æœç´¢æ–‡ä»¶å¤¹ å¹¶ä¸”ä¸‹è½½
    def start_search_dir(self):
        self.search_button['state'] = DISABLED
        self.search_button['text'] = "æ­£åœ¨ä¸‹è½½..."

        self.all_pic_count = 0
        self.current_pic_index = 0
        self.download_error_list = []
        # è·å–Markdownæ–‡ä»¶åˆ—è¡¨
        article_list = Directory.find_sub_path(self.path.get())

        # æ›´æ–°æœç´¢è¿›åº¦ åˆ·æ–°UI
        for article in article_list:
            self.all_pic_count += len(article.pic_list)
        self.change_title(self.all_pic_count, self.current_pic_index)

        # å¼€å§‹ä¸‹è½½å›¾ç‰‡
        for article in article_list:
            for pic in article.pic_list:
                # å¼€å¯å¼‚æ­¥çº¿ç¨‹ä¸‹è½½å›¾ç‰‡ å¹¶ä¸”ä¼ å…¥ä¸‹è½½å®Œæˆçš„å›è°ƒ
                thread = threading.Thread(target=pic.start_download_pic, args=(self.download_pic_callback,))
                thread.start()
</code></pre></div></div>

<p>b. å¼€å¯å¼‚æ­¥çº¿ç¨‹ä¸‹è½½å›¾ç‰‡ï¼Œå›è°ƒå‡½æ•°ä½œä¸ºå…¥å‚ä¼ å…¥ã€‚</p>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-127db2a56d226360.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½å›¾ç‰‡" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  // å¼‚æ­¥ä¸‹è½½
  thread = threading.Thread(target=pic.start_download_pic,   args=(self.download_pic_callback,))
  thread.start()
</code></pre></div></div>

<p>å›è°ƒå‡½æ•°æ›´æ–° UI å‘ŠçŸ¥ä¸‹è½½è¿›åº¦ï¼Œç”±äºå¼€å¯äº†å¤šçº¿ç¨‹ï¼Œè¿™é‡Œéœ€è¦åŠ é”ï¼Œé˜²æ­¢èµ„æºç«äº‰ã€‚å…¨éƒ¨ä¸‹è½½æˆåŠŸåç”ŸæˆæŠ¥å‘Šã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # ä¸‹è½½å›¾ç‰‡å®Œæˆåçš„å›è°ƒå‡½æ•°
    def download_pic_callback(self, pic):
        # è·å–çº¿ç¨‹é”
        self.thread_lock.acquire()
        # å¦‚æœä¸‹è½½å¤±è´¥ åˆ™ä¿å­˜åˆ°å¤±è´¥åˆ—è¡¨
        if pic.error_reason is not None and len(pic.error_reason) &gt; 0:
            self.download_error_list.append(pic)

        self.current_pic_index += 1

        # æ›´æ–°ä¸‹è½½è¿›åº¦ åˆ·æ–°UI
        print('finish:' + str(self.current_pic_index) + '/' + str(self.all_pic_count))
        self.change_title(self.all_pic_count, self.current_pic_index)

        # å…¨éƒ¨ä¸‹è½½æˆåŠŸ åˆ·æ–°UI ç”Ÿæˆå¤±è´¥æŠ¥å‘Š
        if self.all_pic_count == self.current_pic_index:
            self.search_button['text'] = "ä¸‹è½½å®Œæˆ"
            self.print_error(self.download_error_list)

        # é‡Šæ”¾é”
        self.thread_lock.release()

    # æ›´æ–°ä¸‹è½½è¿›åº¦ åˆ·æ–°UI
    def change_title(self, total_num, current_num):
        self.title.set("å·²å®Œæˆ" + str(current_num) + "/" + str(total_num))
</code></pre></div></div>

<p>c. ç”Ÿæˆå¤±è´¥æŠ¥å‘Šï¼Œåˆ©ç”¨ list_box æ¥å±•ç¤ºé”™è¯¯åˆ—è¡¨ï¼Œå¹¶ä¸”æ·»åŠ äº†æ»‘å—ï¼Œå¯ä»¥æ»‘åŠ¨æµè§ˆã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # ç”Ÿæˆå¤±è´¥åˆ—è¡¨
    def print_error(self, download_error_list):
        # python log
        print("-----------------------------------")
        print("some pic download failure:")
        for pic in download_error_list:
            print("")
            print("name:" + pic.name)
            print("url:" + pic.url)
            print("error_reason:" + pic.error_reason)

        Label(self.root, text="éƒ¨åˆ†å›¾ç‰‡ä¸‹è½½å¤±è´¥:").grid(row=4, column=1)

        # GUI
        # æ–°å»ºlistbox
        self.list_box = Listbox(self.root)
        for pic in download_error_list:
            self.list_box.insert(END, pic.url + " -&gt; " + pic.error_reason)
        self.list_box.grid(row=5, column=0, columnspan=3, sticky=W+E+N+S)

        # å‚ç›´ scrollbar
        scr1 = Scrollbar(self.root)
        self.list_box.configure(yscrollcommand=scr1.set)
        scr1['command'] = self.list_box.yview
        scr1.grid(row=5, column=4, sticky=W+E+N+S)
        # æ°´å¹³ scrollbar
        scr2 = Scrollbar(self.root, orient='horizontal')
        self.list_box.configure(xscrollcommand=scr2.set)
        scr2['command'] = self.list_box.xview
        scr2.grid(row=6, column=0, columnspan=3, sticky=W+E+N+S)
</code></pre></div></div>

<p>d. æœ€åè´´ä¸Šå¼•ç”¨åˆ°çš„æ ‡å‡†åº“(Python 2.7)ï¼š</p>

<ol>
  <li><code class="highlighter-rouge"><span class="c1">#!/usr/bin/env python</span></code>å’Œ<code class="highlighter-rouge"># -*- coding:utf-8 -*-</code>è¿™ä¸¤è¡Œæ˜¯ä¸ºäº†æ”¯æŒä¸­æ–‡ã€‚</li>
  <li><code class="highlighter-rouge">os</code>å’Œ<code class="highlighter-rouge">os.path</code>ç”¨äºç³»ç»ŸåŠæ–‡ä»¶æŸ¥æ‰¾ã€‚</li>
  <li><code class="highlighter-rouge">re</code> æ­£åˆ™åŒ¹é…ã€‚</li>
  <li><code class="highlighter-rouge">urllib2</code>ç½‘ç»œåº“ï¼Œç”¨äºä¸‹è½½å›¾ç‰‡ã€‚</li>
  <li><code class="highlighter-rouge">Tkinter</code>å’Œ<code class="highlighter-rouge">tkFileDialog</code>æ˜¯ GUI åº“ã€‚</li>
  <li><code class="highlighter-rouge">threading</code>å¤šçº¿ç¨‹åº“ã€‚
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
# -*- coding:utf-8 -*-
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">tkFileDialog</span>
<span class="kn">import</span> <span class="nn">threading</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="5-python-æ‰“åŒ…å·¥å…·">5. Python æ‰“åŒ…å·¥å…·</h2>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-aa888cebfdb37e99.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/440" alt="æœ€ç»ˆæ•ˆæœ" /></p>

<p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯è®²å¦‚ä½•æŠŠ Python è„šæœ¬æ‰“åŒ…æ‰“åŒ…æˆå¯ä»¥åœ¨ Mac ä¸Šè¿è¡Œçš„åº”ç”¨ã€‚</p>

<h3 id="pyinstaller"><a href="http://www.pyinstaller.org/">PyInstaller</a></h3>

<p>[å›¾ç‰‡ä¸Šä¼ å¤±è´¥â€¦(image-fd72fe-1516382674300)]</p>

<p>PyInstaller æ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ‰“åŒ… Python è„šæœ¬ï¼Œç”Ÿæˆåº”ç”¨ã€‚</p>

<p>å®‰è£… PyInstaller</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pip install pyinstaller
</code></pre></div></div>

<p>æ‰“åŒ…ååœ¨<code class="highlighter-rouge">dist</code>æ–‡ä»¶å¤¹ä¸­å¯æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pyinstaller yourprogram.py
</code></pre></div></div>
<p>ç”Ÿæˆ app</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pyinstaller --onedir -y  main.spec
</code></pre></div></div>

<h3 id="py2app"><a href="https://pypi.python.org/pypi/py2app/">py2app</a></h3>

<p>py2app ä¹Ÿæ˜¯æ‰“åŒ…å·¥å…·ï¼Œè¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæƒ³è¦æ·±å…¥äº†è§£è¯¦ç»†å†…å®¹å¯ä»¥è‡ªè¡Œæœç´¢ã€‚</p>

<p>åˆ‡æ¢åˆ°ä½ çš„å·¥ç¨‹ç›®å½•ä¸‹</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/Desktop/yourprogram
</code></pre></div></div>

<p>ç”Ÿæˆ setup.py æ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ py2applet --make-setup yourprogram.py
</code></pre></div></div>

<p>ç”Ÿæˆä½ çš„åº”ç”¨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python setup.py py2app
</code></pre></div></div>

<h3 id="dmg-canvas"><a href="http://www.araelium.com/dmgcanvas">DMG Canvas</a></h3>

<p><img src="http://upload-images.jianshu.io/upload_images/1319710-a6044f67873d682a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/140" alt="DMGCanvas" /></p>

<p>DMG Canvas å¯ä»¥å°† Mac åº”ç”¨æ‰“åŒ…æˆ DMG é•œåƒæ–‡ä»¶ï¼Œå¹¶ä¸”å‚»ç“œå¼æ“ä½œã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åˆšå¼€å§‹åªæ˜¯å†™äº†å¾ˆç®€å•çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œåæ¥æ…¢æ…¢å®Œå–„ï¼Œé€æ¸æ‰æœ‰äº†ç°åœ¨çš„æ ·å­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬ Python ä¸­çš„ GUI å’Œå¤šçº¿ç¨‹æ“ä½œï¼Œå¦‚ä½•ç”Ÿæˆåº”ç”¨ç¨‹åºã€‚å¸Œæœ›èƒ½å¯¹ä¸€éƒ¨åˆ†äººæœ‰æ‰€å¸®åŠ©ã€‚</p>

<p><strong>æœ€åè´´ä¸Š<a href="https://github.com/xietao3/PyImageDownloader">Demo</a>ï¼Œæœ¬äºº Python 2.7 ç¯å¢ƒä¸‹è¿è¡Œçš„ï¼Œ Python 3ä»¥ä¸Šæ˜¯æ— æ³•è¿è¡Œçš„ã€‚</strong></p>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æœ€è¿‘çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2018/01/ScrapySpider/" title="link to Python èŒæ–° - èŠ±10åˆ†é’Ÿå­¦çˆ¬è™«">Python èŒæ–° - èŠ±10åˆ†é’Ÿå­¦çˆ¬è™«</a></h2>
       <p class="excerpt">  Python æ–°æ‰‹å…¥é—¨å¾ˆå¤šæ—¶å€™éƒ½ä¼šå†™ä¸ªçˆ¬è™«ç»ƒæ‰‹ï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨ Scrapy æ¡†æ¶ï¼Œå¸®ä½ ç®€å•å¿«é€Ÿå®ç°çˆ¬è™«ï¼Œå¹¶å°†æ•°æ®ä¿å­˜è‡³æ•°æ®åº“ã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­æ•°æ®æŒ–æ˜ä¹Ÿæ˜¯ååˆ†é‡è¦çš„ï¼Œæˆ‘çš„æ•°æ®ç§‘å­¦è€å¸ˆæ›¾ç»è¯´è¿‡ï¼Œå¥½ç®—æ³•ä¸å¦‚å¥½æ•°æ®ã€‚ä»‹ç»Scrapy ï¼ŒPython å¼€å‘çš„ä¸€ä¸ªå¿«é€Ÿã€é«˜å±‚æ¬¡çš„å±å¹•æŠ“å–å’Œ web æŠ“å–æ¡†æ¶ï¼Œç”¨äºæŠ“å– web ç«™ç‚¹å¹¶ä»é¡µé¢ä¸­æå–ç»“æ„åŒ–çš„æ•°æ®ã€‚æ–‡ä»¶ç»“æ„æ¸…æ™°ï¼Œå³ä½¿æ˜¯å°ç™½ä¹Ÿèƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ï¼Œæ€»ä¹‹éå¸¸å¥½ç”¨ğŸ˜‚ã€‚XPath ,å®ƒæ˜¯ä¸€ç§ç”¨æ¥æŸ¥æ‰¾ XML æ–‡æ¡£ä¸­èŠ‚ç‚¹ä½ç½®çš„è¯­è¨€ã€‚ XPath åŸºäº XML çš„...&hellip;</p>
       <div class="post-list__meta"><time datetime="2018-01-26 23:40:11 +0800" class="post-list__meta--date date">2018-01-26</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2018/01/ScrapySpider/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">æ›´æ—©çš„æ–‡ç« </span>
       <h2 class="post-list__post-title post-title"><a href="/2017/10/BigData1/" title="link to æ•°æ®ç§‘å­¦å…¥é—¨ (ä¸€) â€”â€” æ•°æ®">æ•°æ®ç§‘å­¦å…¥é—¨ (ä¸€) â€”â€” æ•°æ®</a></h2>
       <p class="excerpt">  Data Scientists - The Sexiest Job of the 21st Centuryã€‚èƒŒæ™¯è¿™æ˜¯æˆ‘ä»¬å…¬å¸å†…éƒ¨çš„å­¦ä¹ å…´è¶£ç­è¯¾ç¨‹ï¼Œå¹¶åŠ ä»¥æ€»ç»“ï¼ŒåŠ æ·±å·©å›ºå­¦ä¹ æ•ˆæœã€‚ä¸€ã€ä»€ä¹ˆæ˜¯æ•°æ®ç§‘å­¦1.1 æ•°æ®ç§‘å­¦æ•°æ®ç§‘å­¦ï¼ˆè‹±è¯­ï¼šData Scienceï¼‰ï¼Œæ˜¯ä¸€é—¨åˆ©ç”¨æ•°æ®å­¦ä¹ çŸ¥è¯†çš„å­¦ç§‘ï¼Œå…¶ç›®æ ‡æ˜¯é€šè¿‡ä»æ•°æ®ä¸­æå–å‡ºæœ‰ä»·å€¼çš„éƒ¨åˆ†æ¥ç”Ÿäº§æ•°æ®äº§å“ã€‚å®ƒç»“åˆäº†è¯¸å¤šé¢†åŸŸä¸­çš„ç†è®ºå’ŒæŠ€æœ¯ï¼ŒåŒ…æ‹¬åº”ç”¨æ•°å­¦ï¼Œç»Ÿè®¡ï¼Œæ¨¡å¼è¯†åˆ«ï¼Œæœºå™¨å­¦ä¹ ï¼Œæ•°æ®å¯è§†åŒ–ï¼Œæ•°æ®ä»“åº“ï¼Œä»¥åŠé«˜æ€§èƒ½è®¡ç®—ã€‚æ•°æ®ç§‘å­¦é€šè¿‡ç”¨è¿ç”¨å„ç§ç›¸å…³çš„æ•°æ®æ¥å¸®åŠ©éä¸“...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-10-23 19:40:11 +0800" class="post-list__meta--date date">2017-10-23</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2017/10/BigData1/>ç»§ç»­é˜…è¯»</a></div>
   </div>
   
</section>

<section class="post-comments">
   
    <div id="gitalk-container"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

    <script type="text/javascript">
      var gitalk = new Gitalk({
        clientID: 'a7e3bcc8c313f6fcf2cf',
        clientSecret: '1d7f990ff0250384dea6b037ce7d6e455d84d472',
        repo: 'xietao3.github.io',
        owner: 'xietao3',
        admin: ['xietao3'],
        id: 'BlogComment',
        distractionFreeMode: true
      });
      gitalk.render('gitalk-container');

    </script>

  



  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… è®¸å¯åè®®</a></span>
        <span class="footer__copyright">æœ¬ç«™ç”± <a href="http://xietao3.com/about">xietao3</a> 
        åˆ›å»ºï¼Œé‡‡ç”¨ <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> ä½œä¸ºä¸»é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ GitHub æ‰¾åˆ°<a href="https://github.com/onevcat/OneV-s-Den">æœ¬ç«™æºç </a> - &copy; 2016</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
